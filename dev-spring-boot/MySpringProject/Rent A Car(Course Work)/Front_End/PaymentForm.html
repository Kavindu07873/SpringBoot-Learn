<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">

</head>
<body style="width: 1450px">
<header>
    <!--  //logo-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <!--      <a class="navbar-brand" href="#">-->
            <!--        <img src="../Assets/dKP.png" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">-->
            <!--        Dkp-Product  </a>-->
        </div>
        <!--/links-->
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Navbar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                    aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>


            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <!--          <a href="../DashBord.html" class="nav-link active" aria-current="page" href="#">Home</a>-->
                    <a class="nav-link active" aria-current="page" href="#">Orders</a>
                    <a class="nav-link active" aria-current="page" href="#">Items</a>
                    <a class="nav-link active" aria-current="page" href="#">Customers</a>

                </div>
            </div>
            <!--  Search-->
        </div>

        <div class="container-fluid">
            <form class="d-flex" role="search">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
        </div>
    </nav>
</header>
<main>

    <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
         aria-labelledby="offcanvasWithBothOptionsLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Payment Management Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">


            <form id="PaymentForm6" class="was-validated">
                <!--                <h1 class="bg-success p-2 text-white bg-opacity-75">Payment Management Details</h1>-->


                <div class="col">
                    <label for="txtUser2">P_Id</label>
                    <input type="text" class="form-control is-invalid" id="txtUser2" placeholder=""
                           name="user"
                           aria-label="User" required>
                </div>


                <div class="col">
                    <label for="txtType2">Type</label>
                    <input type="text" class="form-control is-invalid" id="txtType2" placeholder=""
                           name="type"
                           aria-label="Type" required>
                </div>
                <div class="col">
                    <label for="txtVersion2">Version</label>
                    <input type="text" class="form-control is-invalid" id="txtVersion2" placeholder=""
                           name="version"
                           aria-label="Version" required>
                </div>

                <div class="col">
                    <label for="txtRentFree2">Rent_Free</label>
                    <input type="number" class="form-control is-invalid" id="txtRentFree2" placeholder=""
                           name="rentFree"
                           aria-label="RentFree" required>
                </div>


                <div class="col">
                    <label for="txtTravelDistance2">Travel_Distance</label>
                    <input type="number" id="txtTravelDistance2" class="is-invalid form-control d-inline-block"
                           placeholder=""
                           name="travelDistance"
                           aria-label="TravelDistance" required>
                </div>

                <br>

                <div class="col">
                    <label for="txtLossDamage2">Loss_Damage</label>
                    <input type="number" class="form-control is-invalid" id="txtLossDamage2" placeholder=""
                           name="lossDamage"
                           aria-label="LossDamage" required>
                </div>
                <!--                    <div class="col">-->
                <!--                        <label for="txtUnitPrice2">Unite_price</label>-->
                <!--                        <input type="text" class="form-control is-invalid" id="txtUnitPrice2" placeholder=""-->
                <!--                               name="unitPrice"-->
                <!--                               aria-label="UnitPrice" required>-->
                <!--                    </div>-->
                <div class="col">
                    <label for="txtExtraKmPrice2">Extra_Km_Price</label>
                    <input type="number" id="txtExtraKmPrice2" class="is-invalid form-control"
                           placeholder=""
                           name="extraKmPrice" aria-label="ExtraKmPrice" required>
                </div>

                <br>
                <br>

                <button type="button" id="SavePayment" class="btn btn-primary">Save</button>
                <button type="button" id="BtnUpdate" class="btn btn-success">Update</button>
                <button type="button" id="BtnDelete" class="btn btn-danger">Delete</button>
                <button type="button" id="btnLoadAll" class="btn btn-info">getall</button>
                <br>
            </form>


        </div>
    </div>
    <section>
        <h1 class="bg-success p-2 text-white bg-opacity-75">Payment Details</h1>
    </section>
    <br>

    <button data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions"
            aria-controls="offcanvasWithBothOptions" type="button" class="btn btn-outline-warning btn-lg">Update Payment
        Details
    </button>
    <br>
    <section>
        <h1 class="bg-success p-2 text-white bg-opacity-75">Order Details</h1>
        <form id="PaymentForm3" class="was-validated">

            <div class="row">

                <div class="col">
                    <div class="form-group">
                        <label>Orders :</label>
                        <select class="form-control" id="OrderId">
                        </select>
                        <span class="control-error"
                              id="OrderId-empty-error"></span>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>Order Schedule :</label>
                        <select class="form-control" id="OrderDetailsId">
                        </select>
                        <span class="control-error"
                              id="OrderDetailsId-empty-error"></span>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <label>Order Details :</label>
                        <select class="form-control" id="OrderDetailsId2">
                        </select>
                        <span class="control-error"
                              id="OrderDetailsId2-empty-error"></span>
                    </div>
                </div>
            </div>

            <br>
            <div class="row">

                <div class="col">
                    <label for="txtOrderId">Order Id</label>
                    <input type="text" class="is-invalid form-control" id="txtOrderId" placeholder=""
                           name="orderId"
                           aria-label="OrderId" required>
                </div>
                <div class="col">
                    <label for="txtDate">Date</label>
                    <input type="text" class="is-invalid form-control" id="txtDate" placeholder=""
                           name="date"
                           aria-label="Date" required>
                </div>


                <div class="col">
                    <label for="txtCustomerId">CustomerId</label>
                    <input type="text" id="txtCustomerId" class="is-invalid form-control"
                           placeholder=""
                           name="customerId" aria-label="customerId" required>
                </div>

            </div>
        </form>
        <form id="PaymentForm2" class="was-validated">

            <div class="row">

                <div class="col">
                    <label for="txtCarId">Car_Id</label>
                    <input type="text" class="form-control is-invalid" id="txtCarId" placeholder=""
                           name="CarId"
                           aria-label="CarId" required>
                </div>
                <div class="col">
                    <label for="txtCarType">CarTye</label>
                    <input type="text" class="form-control is-invalid" id="txtCarType" placeholder=""
                           name="carType"
                           aria-label="carType" required>
                </div>
                <div class="col">
                    <label for="txtDriverId">DriverId</label>
                    <input type="text" class="form-control is-invalid" id="txtDriverId" placeholder=""
                           name="driId"
                           aria-label="driId" required>
                </div>
                <div class="col">
                    <label for="txtCarVersion">Version</label>
                    <input type="text" class="form-control is-invalid" id="txtCarVersion" placeholder=""
                           name="carVersion"
                           aria-label="CarVersion" required>
                </div>
                <div class="col">
                    <label for="txtNeed">Need Car</label>
                    <input type="number" class="form-control is-invalid" id="txtNeed" placeholder=""
                           name="need"
                           aria-label="Need" required>
                </div>
                <div class="col">
                    <label for="txtTotalMoney">TotalMoney</label>
                    <input type="number" id="txtTotalMoney" class="is-invalid form-control d-inline-block"
                           placeholder=""
                           name="totalMoney"
                           aria-label="TotalMoney" required>
                </div>

            </div>
            <br>
            <br>

        </form>
        <br>
        <br>
        <section>
            <table style="width: 95%" border="2px solid red"
                   class="col table table-bordered border-primary table-dark table-striped">
                <thead class="bg-danger text-white">
                <tr>
                    <th>P_Id</th>
                    <th>Type</th>
                    <th>Version</th>
                    <th>Rent_Free</th>
                    <th>Travel_Distance</th>
                    <th>Loss_Damage</th>
                    <th>Extra_Km_Price</th>
                </tr>
                </thead>
                <tbody id="tblPayment">

                </tbody>
            </table>

        </section>
        <br>
        <br>
        <h1 class="bg-success p-2 text-white bg-opacity-75">Payment Management Details</h1>

        <div class="row">

            <div class="col">
                <label for="txtUser">P_Id</label>
                <input type="text" class="form-control is-invalid" id="txtUser" placeholder=""
                       name="user"
                       aria-label="User" required>
            </div>


            <div class="col">
                <label for="txtType">Type</label>
                <input type="text" class="form-control is-invalid" id="txtType" placeholder=""
                       name="type"
                       aria-label="Type" required>
            </div>
            <div class="col">
                <label for="txtVersion">Version</label>
                <input type="text" class="form-control is-invalid" id="txtVersion" placeholder=""
                       name="version"
                       aria-label="Version" required>
            </div>

            <div class="col">
                <label for="txtRentFree">Rent_Free</label>
                <input type="number" class="form-control is-invalid" id="txtRentFree" placeholder=""
                       name="rentFree"
                       aria-label="RentFree" required>
            </div>


            <div class="col">
                <label for="txtTravelDistance">Travel_Distance</label>
                <input type="number" id="txtTravelDistance" class="is-invalid form-control d-inline-block"
                       placeholder=""
                       name="travelDistance"
                       aria-label="TravelDistance" required>
            </div>

        </div>
        <br>
        <div class="row">

            <div class="col">
                <label for="txtLossDamage">Loss_Damage</label>
                <input type="number" class="form-control is-invalid" id="txtLossDamage" placeholder=""
                       name="lossDamage"
                       aria-label="LossDamage" required>
            </div>

            <div class="col">
                <label for="txtExtraKmPrice">Extra_Km_Price</label>
                <input type="number" id="txtExtraKmPrice" class="is-invalid form-control"
                       placeholder=""
                       name="extraKmPrice" aria-label="ExtraKmPrice" required>
            </div>
        </div>
        <br>
        <br>
        <h1 class="bg-success p-2 text-white bg-opacity-75">Input detais</h1>

        <br>
        <div class="row">

            <div class="col">
                <label for="txtDriverFree">Driver Free</label>
                <input type="number" class="form-control is-invalid" id="txtDriverFree" placeholder=""
                       name="driverFree"
                       aria-label="DriverFree" required>
            </div>

            <div class="col">
                <label for="txtTravelDistanceLast">Travel Distance Last</label>
                <input type="number" id="txtTravelDistanceLast" class="is-invalid form-control"
                       placeholder=""
                       name="travelDistanceLast" aria-label="TravelDistanceLast" required>
            </div>
            <div class="col">
                <label for="txtCalcLossDamage">Calc_LossDamage</label>
                <input type="number" id="txtCalcLossDamage" class="is-invalid form-control d-inline-block"
                       placeholder=""
                       name="calcLossDamage"
                       aria-label="CalcLossDamage" required>
            </div>

        </div>
        <br>

        <div class="row">


            <div class="col">
                <label for="txtReceiveDate">Receive Date</label>
                <input type="date" class="form-control is-invalid" id="txtReceiveDate" placeholder=""
                       name="receiveDate"
                       aria-label="ReceiveDate" required>
            </div>


            <div class="col">
                <label for="txtExtraKm">Extra Km</label>
                <input type="number" id="txtExtraKm" class="is-invalid form-control d-inline-block"
                       placeholder=""
                       name="extraKm"
                       aria-label="ExtraKm" required>
            </div>
            <div class="col">

                <button type="button" id="btnOk" class="btn btn-primary btn-lg">Ok</button>
            </div>
        </div>
        <br>
        <br>

        <form id="PaymentForm" class="was-validated">
            <h1 class="bg-success p-2 text-white bg-opacity-75">Payment Finalize Details</h1>
            <br>
            <div class="row">

                <div class="col">
                    <label for="txtFinalLostDamageValue">Final_LostDamage_Value</label>
                    <input type="number" class="is-invalid form-control" id="txtFinalLostDamageValue" placeholder=""
                           name="finalLostDamageValue"
                           aria-label="FinalLostDamageValue" required>
                </div>

                <div class="col">
                    <label for="txtFinalExtraKm">Extra_Km_Price</label>
                    <input type="number" id="txtFinalExtraKm" class="is-invalid form-control"
                           placeholder=""
                           name="extraKmPrice" aria-label="ExtraKmPrice" required>
                </div>
                <div class="col">
                    <label for="txtPrice">Full_Payment</label>
                    <input type="number" id="txtPrice" class="is-invalid form-control"
                           placeholder=""
                           name="fullPayment" aria-label="FullPayment" required>
                </div>

            </div>

        </form>
        <br>

        <section>
            <table style="width: 95%" border="2px solid red"
                   class="col table table-bordered border-primary table-dark table-striped">
                <thead class="bg-danger text-white">
                <tr>
                    <th>VehicleId</th>
                    <th>Type</th>
                    <th>Version</th>
                    <th>No Of Car</th>
                    <th>FullPayment</th>

                </tr>
                </thead>
                <tbody id="tblCartPayment">

                </tbody>
            </table>

        </section>
        <br>
        <section>
            <div >
                <label for="txtAllOrdersTotal">TotalAll</label>
                <input type="number" class="is-invalid form-control" id="txtAllOrdersTotal" placeholder=""
                       name="totalAll"
                       aria-label="totalAll" required>
            </div>
        </section>


        <br>


        <div class="d-grid gap-2">
<!--            <button id="SaveAllData " class="btn btn-primary btn-danger btn-lg " type="button">Save All</button>-->
            <button type="button" id="SaveAllData" class="btn btn-primary btn-lg">Ok</button>

        </div>
        <br>
        <br>

    </section>
    <br>

</main>

<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/jquery-3.6.1.min.js"></script>


<script>
    $("#BtnClearAll").click(function () {
        setTextFieldValues();
        // $("#txtCustomerNic").refresh();

    });

    let baseURL = "http://localhost:8080/Back_End_war/";

    getAll();
    getAllOrders();
    getAllOrdersDetails();
    getOrderDetails();

    $("#SavePayment").click(function () {

        var formData = $("#PaymentForm6").serialize();
        console.log(formData);
        $.ajax({
            url: baseURL + "Payment",
            method: "post",
            data: formData,
            dataType: "json",
            success: function (res) {
                alert(res.message);
                getAll();
            },
            error: function (error) {
                var jsObject = JSON.parse(error.responseText);
                alert(jsObject.message);
            }
        });
    });

    $("#btnLoadAll").click(function () {
        getAll()
    });

    // update value
    $("#BtnUpdate").click(function () {

        let P_Id = $("#txtUser").val();
        let Rent_Free = $("#txtVersion").val();
        let Driver_Free = $("#txtType").val();
        let Travel_Distance = $("#txtFuel").val();
        let Loss_Damage = $("#txtPassengers").val();
        let calc_LossDamage = $("#txtTransmission").val();
        let Payment_Date = $("#txtColour").val();
        let Extra_Km = $("#txtRent_duration").val();
        let Extra_Km_Price = $("#txtPrice").val();
        let Full_Payment = $("#txtPrice_ExtraKm").val();


        var Payment = {
            user: P_Id,
            rentFree: Rent_Free,
            driverFree: Driver_Free,
            travelDistance: Travel_Distance,
            lossDamage: Loss_Damage,
            calcLossDamage: calc_LossDamage,
            paymentDate: Payment_Date,
            extraKm: Extra_Km,
            extraKmPrice: Extra_Km_Price,
            fullPayment: Full_Payment
        }

        $.ajax({
            url: baseURL + 'Payment',
            method: 'put',
            contentType: "application/json",
            data: JSON.stringify(Payment),
            dataType: "json",
            success: function (res) {
                alert(res.message);
                getAll();
            },
            error: function (error) {
                let cause = JSON.parse(error.responseText).message;
                alert(cause);
            }

        });
    });

    //Delete Value
    // $("#BtnDelete").click(function () {
    //
    //     let id = $("#txtCustomerID").val();
    //     $.ajax({
    //         url: baseURL+"Customer?id=" + id + "",
    //         method: "delete",
    //         dataType:"json",
    //         success: function (resp) {
    //             alert(resp.message);
    //             getAll();
    //         },
    //         error:function (error){
    //             alert(JSON.parse(error.responseText).message);
    //         }
    //     });
    // });

    function getAll() {
        $("#tblPayment").empty();

        $.ajax({
            url: baseURL + "Payment",
            dataType: "json",
            success: function (resp) {
                console.log(resp);

                for (let cus of resp.data) {

                    var rows = '<tr><td>' + cus.user +
                        '</td><td>' + cus.type +
                        '</td><td>' + cus.version +
                        '</td><td>' + cus.rentFree +
                        '</td><td>' + cus.travelDistance +
                        '</td><td>' + cus.lossDamage +
                        '</td><td>' + cus.extraKmPrice +
                        '</td></tr>';
                    // console.log(row);
                    $("#tblPayment").append(rows);

                }
                EventBindingvalue();
                setTextFieldValues("", "", "", "", "", "", "", "");
                $("#txtUser2").focus();
            }
        });
    }

    function setTextFieldValues(user, Type, Version, rentFree, driverFree, travelDistance, lossDamage, extraKmPrice) {
        $("#txtUser2").val(user);
        $("#txtVersion2").val(Version);
        $("#txtType2").val(Type);
        $("#txtRentFree2").val(rentFree);
        $("#txtTravelDistance2").val(travelDistance);
        $("#txtLossDamage2").val(lossDamage);
        $("#txtExtraKmPrice2").val(extraKmPrice);

        $("#txtUser").val(user);
        $("#txtVersion").val(Version);
        $("#txtType").val(Type);
        $("#txtRentFree").val(rentFree);
        $("#txtTravelDistance").val(travelDistance);
        $("#txtLossDamage").val(lossDamage);
        $("#txtExtraKmPrice").val(extraKmPrice);
    }

    //  mehidi table eka click karama data print we
    function EventBindingvalue() {
        $("#tblPayment>tr").click(function () {

            let user = $(this).children(":eq(0)").text();
            let Type = $(this).children(":eq(1)").text();
            let Version = $(this).children(":eq(2)").text();
            let rentFree = $(this).children(":eq(3)").text();
            let travelDistance = $(this).children(":eq(4)").text();
            let lossDamage = $(this).children(":eq(5)").text();
            let extraKmPrice = $(this).children(":eq(6)").text();
            // let extraKm = $(this).children(":eq(7)").text();
            // let extraKmPrice = $(this).children(":eq(8)").text();
            // let fullPayment = $(this).children(":eq(9)").text();

            //  tble eke textfild walata data add karanawa
            $("#txtUser2").val(user);
            $("#txtVersion2").val(Version);
            $("#txtType2").val(Type);
            $("#txtRentFree2").val(rentFree);
            $("#txtTravelDistance2").val(travelDistance);
            $("#txtLossDamage2").val(lossDamage);
            $("#txtExtraKmPrice2").val(extraKmPrice);

            $("#txtUser").val(user);
            $("#txtVersion").val(Version);
            $("#txtType").val(Type);
            $("#txtRentFree").val(rentFree);
            $("#txtTravelDistance").val(travelDistance);
            $("#txtLossDamage").val(lossDamage);
            $("#txtExtraKmPrice").val(extraKmPrice);

        });

        // //double click remove table colom
        // $("#tblCustomer>tr").on('dblclick', function () {
        //     $(this).remove();
        // });

    }

    // //Enter Button use for textfield
    // $("#txtCustomerID").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         $("#txtCustomerName").focus();
    //     }
    //
    // });
    //
    // $("#txtCustomerName").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         $("#txtCustomerContNo").focus();
    //     }
    //
    // });
    //
    // $("#txtCustomerContNo").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         $("#txtCustomerAddress").focus();
    //     }
    //
    // });

    // $("#txtCustomerAddress").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         $("#txtCustomerSalary").focus();
    //     }
    //
    // });
    //
    // $("#txtCustomerSalary").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         confirm("Do You Want To Add This Customer...?")
    //         $("#SaveCustomer").focus();
    //     }
    //
    // });

    // Tap Button Remove
    // $("#txtCustomerID,#txtCustomerName,#txtCustomerCon,#txtCustomerAddress,#txtCustomerSalary").on('keydown', function (event) {
    //
    //     if (event.key == "Tab") {
    //         event.preventDefault();
    //     }
    // });

    function getAllOrders() {
        $("#OrderId").empty();
        $.ajax({
            url: baseURL + "purchase",
            dataType: "json",
            success: function (resp) {
                // console.log(resp);
                for (let cus of resp.data) {
                    // console.log(cus.orderId);
                    console.log(cus.oid);

                    $("#OrderId").append(`<option value="${cus.oid}">${cus.oid}</option>`);

                }
            }
        });
    }

    function searchOrders(OderId) {
        let response = "";
        $.ajax({
            url: baseURL + "purchase",
            dataType: "json",
            async: false,
            success: function (resp) {
                response = resp.data.filter((c) => {
                    return c.oid == OderId;
                });
            }
        });
        console.log(response);
        return response;
    }

    $("#OrderId").change(function () {
        let OderId = $("#OrderId").val();
        $("#OrderId").val(OderId);
        let res = searchOrders(OderId);
        if (res.length > 0) {

            $("#txtOrderId").val(res[0].oid);
            $("#txtDate").val(res[0].date);
            $("#txtCustomerId").val(res[0].cusID);
            $("#OrderDetailsId").val(res[0].scheduleId);

        }

    });

    function getAllOrdersDetails() {
        $("#OrderDetailsId").empty();
        $.ajax({
            url: baseURL + "purchase",
            dataType: "json",
            success: function (resp) {
                console.log(resp);
                for (let cus of resp.data) {

                    $("#OrderDetailsId").append(`<option value="${cus.scheduleId}">${cus.scheduleId}</option>`);

                }
            }
        });
    }

    function searchOrdersDetails(ScheduleIds) {
        let response = "";
        $.ajax({
            url: baseURL + "purchase",
            dataType: "json",
            async: false,
            success: function (resp) {
                response = resp.data.filter((c) => {
                    return c.scheduleId == ScheduleIds;
                });
            }
        });
        // console.log(response);
        return response;
    }

    // $("#OrderDetailsId").change(function () {
    //     let ScheduleIds = $("#OrderDetailsId").val();
    //     $("#OrderDetailsId").val(ScheduleIds);
    //     let res = searchOrdersDetails(ScheduleIds);
    //     if (res.length > 0) {
    //
    //         // $("#txtOrderId").val(res[0].orderId);
    //         // $("#txtDate").val(res[0].date);
    //         // $("#txtCustomerId").val(res[0].customerId);
    //
    //
    //     }
    //
    // });


    function getOrderDetails(){
            $("#OrderDetailsId2").empty();
        $.ajax({
            url: baseURL + "purchaseDetails",
            dataType: "json",
            success: function (resp) {
                // console.log(resp);
                for (let ord of resp.data) {

                    $("#OrderDetailsId2").append(`<option value="${ord.vehicle}">${ord.vehicle}</option>`);

                }
            }
        });
    }

    function searchOrdersDetails2(VehicleId) {
        let response = "";
        $.ajax({
            url: baseURL + "purchaseDetails",
            dataType: "json",
            async: false,
            success: function (resp) {
                response = resp.data.filter((c) => {
                    return c.vehicle == VehicleId;
                });
            }
        });
        console.log(response);
        return response;
    }

    $("#OrderDetailsId2").change(function () {
        let VehicleId = $("#OrderDetailsId2").val();
        $("#OrderDetailsId2").val(VehicleId);
        let res = searchOrdersDetails2(VehicleId);
        if (res.length > 0) {
            $("#txtCarId").val(res[0].carId);
            $("#txtDriverId").val(res[0].user);
            $("#txtCarType").val(res[0].type);
            $("#txtCarVersion").val(res[0].version);
            $("#txtNeed").val(res[0].need);
            $("#txtTotalMoney").val(res[0].total);


        }

    });

    $("#btnOk").click(function () {


        var extra = $("#txtExtraKm").val();//
        var last = $("#txtTravelDistanceLast").val();
        var disance = $("#txtTravelDistance").val();

        var PriceExtra = $("#txtExtraKmPrice").val();
        var needCar = $("#txtNeed").val();

        var defaultlossdamage = $("#txtLossDamage").val();
        var finallossdamage = $("#txtFinalLostDamageValue").val();
        var Calclossdamage = $("#txtCalcLossDamage").val();

        var carTotal = $("#txtTotalMoney").val();
        var driverfree = $("#txtDriverFree").val();
        var unitPrice = $("#txtRentFree").val();

        var finalTotalValue = $("#txtPrice").val();


        console.log(unitPrice * 1 + driverfree * 1)

        if (last > disance) {
            console.log(extra, last, disance)
            extra = (last - disance)
            console.log(extra)

            $("#txtExtraKm").val(extra);
        }

        if (extra > 0) {
            var finalExtra = (PriceExtra * extra) / needCar;
            console.log(finalExtra)
            $("#txtFinalExtraKm").val(finalExtra)
        } else {
            var q = 0;
            $("#txtExtraKm").val(q);
            $("#txtFinalExtraKm").val(q)
        }

        var finallossdamage = (Calclossdamage - defaultlossdamage);
        $("#txtFinalLostDamageValue").val(finallossdamage);


        var finalTotalValue = (carTotal * 1 + driverfree * 1 + finallossdamage * 1 + finalExtra * 1);
        console.log(finalTotalValue)
        //finallossdamage ++ finalExtra
        $("#txtPrice").val(finalTotalValue * 1);

        loadAllData();

    });

    function loadAllData() {
        var PaymentAll = [];


        let Vehicle = $("#OrderDetailsId2").val()
        let Type = $("#txtCarType").val()
        let Version = $("#txtCarVersion").val()
        let Need = $("#txtNeed").val()
        let Total = $("#txtPrice").val()
        var CartObject = {
            Code: Vehicle,
            Name: Type,
            Price: Version,
            Qty: Need,
            TotalPrice: Total
        }

        PaymentAll.push(CartObject);

        for (var pay of PaymentAll) {
            var raw = `<tr><td>${pay.Code}</td><td>${pay.Name}</td><td>${pay.Price}
                        </td><td>${pay.Qty}
                        </td><td>${pay.TotalPrice}</td></tr>`;

            $("#tblCartPayment").append(raw);
            CalculationTotal();
        }
        doubleclick();
    }

    function doubleclick() {
        // $("#tblOrderDetails>tr").on('dblclick', function () {
        //     $(this).remove();
        // });
        $("#tblCartPayment>tr").on('dblclick', function () {
            $(this).remove();
        });
    }

    function CalculationTotal(){

        let length = $('#tblCartPayment>tr').length;
        let total = 0;

        for (let i=0;i<length;i++){
            let oneitemTotal = $('#tblCartPayment>tr').eq(i).children().eq('4').text();
            let NumberValue = parseFloat(oneitemTotal);

            total = total + NumberValue
            $("#txtAllOrdersTotal").val(total);
        }

    }

    $("#SaveAllData").click(function () {

        let OrderId = $("#txtOrderId").val();
        let CustomerId = $("#txtCustomerId").val();
        let DriverId = $("#txtDriverId").val();
        let date = $("#txtDate").val();
        let receiveDate = $("#txtReceiveDate").val();
        let finalTotalValue = $("#txtAllOrdersTotal").val();

        console.log("Add0-"+CustomerId + DriverId + finalTotalValue+finalTotalValue);

        let ob = {
            oid: OrderId,
            customerId:CustomerId,
            driId:DriverId,
            date: date,
            receiveDate:receiveDate,
            totalAll:finalTotalValue,

        }
        console.log(ob)
        //send request
        $.ajax({
            url: baseURL + "Finalize",
            method: "post",
            dataType: "json",
            data: JSON.stringify(ob),
            contentType: "application/json",
            success: function (resp) {
                alert(resp.message);
            },
            error: function (error) {
                alert(JSON.parse(error.responseText).message);
            }
        });

    });


</script>
</body>
</html>